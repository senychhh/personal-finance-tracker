# –ü—Ä–∏–≤—è–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∫ —Å—á–µ—Ç–∞–º - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ

## üìã –û–±–∑–æ—Ä

–ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –æ–¥–Ω–æ–º—É —Å—á–µ—Ç—É —á–µ—Ä–µ–∑ –ø–æ–ª–µ `account_id`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, —Å –∫–∞–∫–æ–≥–æ —Å—á–µ—Ç–∞ –±—ã–ª –¥–æ—Ö–æ–¥ –∏–ª–∏ –Ω–∞ –∫–∞–∫–æ–π —Å—á–µ—Ç –±—ã–ª —Ä–∞—Å—Ö–æ–¥, –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞.

## üîó –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–≤—è–∑–∏

### –í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Å—á–µ—Ç–æ–≤
accounts (
    id SERIAL PRIMARY KEY,
    user_id INTEGER,
    balance DECIMAL(15, 2) DEFAULT 0.00,  -- –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
    ...
)

-- –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
transactions (
    id SERIAL PRIMARY KEY,
    account_id INTEGER NOT NULL REFERENCES accounts(id),  -- –°–≤—è–∑—å —Å —Å—á–µ—Ç–æ–º
    amount DECIMAL(15, 2) NOT NULL,  -- –°—É–º–º–∞ (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è/–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è)
    type category_type NOT NULL,  -- 'income' –∏–ª–∏ 'expense'
    ...
)
```

### –°–≤—è–∑—å:
- **–û–¥–∏–Ω —Å—á–µ—Ç** ‚Üí **–ú–Ω–æ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)
- –ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –æ–¥–Ω–æ–º—É —Å—á–µ—Ç—É
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—á–µ—Ç–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`ON DELETE CASCADE`)

## üí∞ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:

```javascript
// –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
{
    account_id: 1,           // ID —Å—á–µ—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
    category_id: 5,          // ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    amount: 1000.00,         // –°—É–º–º–∞
    type: 'income',          // –¢–∏–ø: 'income' –∏–ª–∏ 'expense'
    description: '–ó–∞—Ä–ø–ª–∞—Ç–∞',
    transaction_date: '2026-01-15'
}
```

### 2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Å—á–µ—Ç–∞:**

**–î–ª—è –¥–æ—Ö–æ–¥–æ–≤ (income):**
- `amount` –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1000.00`)
- –ë–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞ **—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è**: `balance = balance + amount`

**–î–ª—è —Ä–∞—Å—Ö–æ–¥–æ–≤ (expense):**
- `amount` –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `-500.00`)
- –ë–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞ **—É–º–µ–Ω—å—à–∞–µ—Ç—Å—è**: `balance = balance + amount` (—Ç.–∫. amount —É–∂–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ)

### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞:**

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç—Ä–∏–≥–≥–µ—Ä –≤ PostgreSQL:

```sql
-- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: –æ–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞
CREATE TRIGGER update_account_balance_on_insert
AFTER INSERT ON transactions
FOR EACH ROW
EXECUTE FUNCTION update_account_balance();

-- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞–ª–∞–Ω—Å
CREATE TRIGGER update_account_balance_on_update
AFTER UPDATE ON transactions
FOR EACH ROW
WHEN (OLD.amount IS DISTINCT FROM NEW.amount OR OLD.account_id IS DISTINCT FROM NEW.account_id)
EXECUTE FUNCTION update_account_balance();

-- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –±–∞–ª–∞–Ω—Å
CREATE TRIGGER update_account_balance_on_delete
AFTER DELETE ON transactions
FOR EACH ROW
EXECUTE FUNCTION update_account_balance();
```

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –î–æ—Ö–æ–¥ –Ω–∞ —Å—á–µ—Ç

**–ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –°—á–µ—Ç "–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—à–µ–ª—ë–∫": –±–∞–ª–∞–Ω—Å = 5000 BR

**–°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:**
```sql
INSERT INTO transactions (account_id, amount, type, description)
VALUES (1, 1000.00, 'income', '–ó–∞—Ä–ø–ª–∞—Ç–∞');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: 5000 + 1000 = **6000 BR**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Å—á–µ—Ç—É ID=1

### –ü—Ä–∏–º–µ—Ä 2: –†–∞—Å—Ö–æ–¥ —Å–æ —Å—á–µ—Ç–∞

**–ò—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –°—á–µ—Ç "–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—à–µ–ª—ë–∫": –±–∞–ª–∞–Ω—Å = 6000 BR

**–°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é:**
```sql
INSERT INTO transactions (account_id, amount, type, description)
VALUES (1, -500.00, 'expense', '–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ë–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è: 6000 + (-500) = **5500 BR**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —Å—á–µ—Ç—É ID=1

### –ü—Ä–∏–º–µ—Ä 3: –ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏

–î–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è **–¥–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**:

1. **–†–∞—Å—Ö–æ–¥ —Å –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å—á–µ—Ç–∞:**
```sql
INSERT INTO transactions (account_id, amount, type, description)
VALUES (1, -1000.00, 'expense', '–ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ –∫–∞—Ä—Ç—É');
```

2. **–î–æ—Ö–æ–¥ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Å—á–µ—Ç:**
```sql
INSERT INTO transactions (account_id, amount, type, description)
VALUES (2, 1000.00, 'income', '–ü–µ—Ä–µ–≤–æ–¥ —Å –∫–æ—à–µ–ª—å–∫–∞');
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—á–µ—Ç 1: –±–∞–ª–∞–Ω—Å —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ 1000 BR
- –°—á–µ—Ç 2: –±–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 1000 BR

## üîç –ó–∞–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å—á–µ—Ç–∞:

```sql
SELECT t.*, c.name as category_name
FROM transactions t
LEFT JOIN categories c ON t.category_id = c.id
WHERE t.account_id = 1
ORDER BY t.transaction_date DESC;
```

### –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞ —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:

```sql
SELECT 
    a.id,
    a.name,
    a.balance as current_balance,
    COALESCE(SUM(t.amount), 0) as calculated_balance
FROM accounts a
LEFT JOIN transactions t ON a.id = t.account_id
WHERE a.id = 1
GROUP BY a.id, a.name, a.balance;
```

### –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—á–µ—Ç–µ:

```sql
SELECT 
    t.id,
    t.amount,
    t.type,
    t.description,
    t.transaction_date,
    a.name as account_name,
    c.name as category_name
FROM transactions t
JOIN accounts a ON t.account_id = a.id
LEFT JOIN categories c ON t.category_id = c.id
WHERE t.user_id = 1
ORDER BY t.transaction_date DESC;
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### 1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–≤—è–∑–∫–∏:**
- –ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å `account_id`
- –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –±–µ–∑ —Å—á–µ—Ç–∞
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—á–µ—Ç–∞ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### 2. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á (`FOREIGN KEY`) –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º `account_id`
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç, –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–∏–ª–∏ –æ–Ω–∏ —É–¥–∞–ª—è—Ç—Å—è –≤–º–µ—Å—Ç–µ)

### 3. **–ë–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞:**
- –ë–∞–ª–∞–Ω—Å –¥–æ–ª–∂–µ–Ω –≤—Å–µ–≥–¥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å—É–º–º–µ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –¢—Ä–∏–≥–≥–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –±–∞–ª–∞–Ω—Å –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–∞–ª–∞–Ω—Å –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è

### 4. **–í–∞–ª—é—Ç—ã:**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞—Å–ª–µ–¥—É–µ—Ç –≤–∞–ª—é—Ç—É –æ—Ç —Å—á–µ—Ç–∞
- –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∞–ª—é—Ç–∞–º–∏ (–Ω—É–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è)

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

### –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ:

1. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Å—á–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞
   - –í–≤–æ–¥–∏—Ç —Å—É–º–º—É –∏ —Ç–∏–ø (–¥–æ—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥)
   - –ë–∞–ª–∞–Ω—Å —Å—á–µ—Ç–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

2. **–ü—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—á–µ—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –ú–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ —Å—á–µ—Ç—É
   - –í–∏–¥–Ω–æ, –∫–∞–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–≤–ª–∏—è–ª–∞ –Ω–∞ –±–∞–ª–∞–Ω—Å

3. **–ü—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ —Å—á–µ—Ç–∞:**
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
   - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —ç—Ç–æ–≥–æ —Å—á–µ—Ç–∞
   - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–∞–ª–∞–Ω—Å–∞

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–∏–≤—è–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∫ —Å—á–µ—Ç–∞–º –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ß–µ—Ç–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—á–µ—Ç–∞–º–∏
- ‚úÖ –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏
